<<<<<<< HEAD
{"body": "<div class=\"section\" id=\"using-the-restore-algorithm-for-robust-tensor-fitting\">\n<span id=\"example-restore-dti\"></span><h1>Using the RESTORE algorithm for robust tensor fitting<a class=\"headerlink\" href=\"#using-the-restore-algorithm-for-robust-tensor-fitting\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>The diffusion tensor model takes into account certain kinds of noise (thermal),\nbut not other kinds, such as &#8220;physiological&#8221; noise. For example, if a subject\nmoves during the acquisition of one of the diffusion-weighted samples, this\nmight have a substantial effect on the parameters of the tensor fit calculated\nin all voxels in the brain for that subject. One of the pernicious consequences\nof this is that it can lead to wrong interpretation of group differences. For\nexample, some groups of participants (e.g. young children, patient groups,\netc.) are particularly prone to motion and differences in tensor parameters and\nderived statistics (such as FA) due to motion would be confounded with actual\ndifferences in the physical properties of the white matter. An example of this\nwas shown in a paper by Yendiki et al. <a class=\"footnote-reference\" href=\"#id4\" id=\"id1\">[1]</a>.</p>\n<p>One of the strategies to deal with this problem is to apply an automatic method\nfor detecting outliers in the data, excluding these outliers and refitting the\nmodel without the presence of these outliers. This is often referred to as\n&#8220;robust model fitting&#8221;. One of the common algorithms for robust tensor fitting\nis called RESTORE, and was first proposed by Chang et al. <a class=\"footnote-reference\" href=\"#id5\" id=\"id2\">[2]</a>.</p>\n<p>In the following example, we will demonstrate how to use RESTORE on a simulated\ndataset, which we will corrupt by adding intermittent noise.</p>\n<p>We start by importing a few of the libraries we will use.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">nibabel</span> <span class=\"k\">as</span> <span class=\"nn\">nib</span>\n</pre></div>\n</div>\n<p>The module <code class=\"docutils literal\"><span class=\"pre\">dipy.reconst.dti</span></code> contains the implementation of tensor fitting,\nincluding an implementation of the RESTORE algorithm.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">dipy.reconst.dti</span> <span class=\"k\">as</span> <span class=\"nn\">dti</span>\n<span class=\"n\">reload</span><span class=\"p\">(</span><span class=\"n\">dti</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p><code class=\"docutils literal\"><span class=\"pre\">dipy.data</span></code> is used for small datasets that we use in tests and examples.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">dipy.data</span> <span class=\"k\">as</span> <span class=\"nn\">dpd</span>\n</pre></div>\n</div>\n<p><code class=\"docutils literal\"><span class=\"pre\">dipy.viz.fvtk</span></code> is used for 3D visualization and matplotlib for 2D\nvisualizations:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">dipy.viz.fvtk</span> <span class=\"k\">as</span> <span class=\"nn\">fvtk</span>\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"nn\">plt</span>\n</pre></div>\n</div>\n<p>If needed, the fetch_stanford_hardi function will download the raw dMRI dataset\nof a single subject. The size of this dataset is 87 MBytes. You only need to\nfetch once.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dpd</span><span class=\"o\">.</span><span class=\"n\">fetch_stanford_hardi</span><span class=\"p\">()</span>\n<span class=\"n\">img</span><span class=\"p\">,</span> <span class=\"n\">gtab</span> <span class=\"o\">=</span> <span class=\"n\">dpd</span><span class=\"o\">.</span><span class=\"n\">read_stanford_hardi</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>We initialize a DTI model class instance using the gradient table used in the\nmeasurement. By default, dti.Tensor model will use a weighted least-squares\nalgorithm (described in <a class=\"footnote-reference\" href=\"#id5\" id=\"id3\">[2]</a>) to fit the parameters of the model. We initialize\nthis model as a baseline for comparison of noise-corrupted models:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dti_wls</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">TensorModel</span><span class=\"p\">(</span><span class=\"n\">gtab</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>For the purpose of this example, we will focus on the data from a region of\ninterest (ROI) surrounding the Corpus Callosum. We define that ROI as the\nfollowing indices:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">roi_idx</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nb\">slice</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">,</span><span class=\"mi\">50</span><span class=\"p\">),</span> <span class=\"nb\">slice</span><span class=\"p\">(</span><span class=\"mi\">55</span><span class=\"p\">,</span><span class=\"mi\">85</span><span class=\"p\">),</span> <span class=\"nb\">slice</span><span class=\"p\">(</span><span class=\"mi\">38</span><span class=\"p\">,</span><span class=\"mi\">39</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<p>And use them to index into the data:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">img</span><span class=\"o\">.</span><span class=\"n\">get_data</span><span class=\"p\">()[</span><span class=\"n\">roi_idx</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>This dataset is not very noisy, so we will artificially corrupt it to simulate\nthe effects of &#8220;physiological&#8221; noise, such as subject motion. But first, let&#8217;s\nestablish a baseline, using the data as it is:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fit_wls</span> <span class=\"o\">=</span> <span class=\"n\">dti_wls</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n\n<span class=\"n\">fa1</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls</span><span class=\"o\">.</span><span class=\"n\">fa</span>\n<span class=\"n\">evals1</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls</span><span class=\"o\">.</span><span class=\"n\">evals</span>\n<span class=\"n\">evecs1</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls</span><span class=\"o\">.</span><span class=\"n\">evecs</span>\n<span class=\"n\">cfa1</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">color_fa</span><span class=\"p\">(</span><span class=\"n\">fa1</span><span class=\"p\">,</span> <span class=\"n\">evecs1</span><span class=\"p\">)</span>\n<span class=\"n\">sphere</span> <span class=\"o\">=</span> <span class=\"n\">dpd</span><span class=\"o\">.</span><span class=\"n\">get_sphere</span><span class=\"p\">(</span><span class=\"s1\">&#39;symmetric724&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>We visualize the ODFs in the ROI using fvtk:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">ren</span> <span class=\"o\">=</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">ren</span><span class=\"p\">()</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"n\">evals1</span><span class=\"p\">,</span> <span class=\"n\">evecs1</span><span class=\"p\">,</span> <span class=\"n\">cfa1</span><span class=\"p\">,</span> <span class=\"n\">sphere</span><span class=\"p\">))</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as tensor_ellipsoids_wls.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">n_frames</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tensor_ellipsoids_wls.png&#39;</span><span class=\"p\">,</span>\n            <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id8\">\n<img alt=\"../../_images/tensor_ellipsoids_wls.png\" src=\"../../_images/tensor_ellipsoids_wls.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Tensor Ellipsoids</strong>.</span></p>\n</div>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">clear</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Next, we corrupt the data with some noise. To simulate a subject that moves\nintermittently, we will replace a few of the images with a very low signal</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">noisy_data</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n<span class=\"n\">noisy_idx</span> <span class=\"o\">=</span> <span class=\"nb\">slice</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>  <span class=\"c1\"># The last 10 volumes are corrupted</span>\n<span class=\"n\">noisy_data</span><span class=\"p\">[</span><span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"n\">noisy_idx</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mf\">1.0</span>\n</pre></div>\n</div>\n<p>We use the same model to fit this noisy data</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fit_wls_noisy</span> <span class=\"o\">=</span> <span class=\"n\">dti_wls</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">noisy_data</span><span class=\"p\">)</span>\n<span class=\"n\">fa2</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls_noisy</span><span class=\"o\">.</span><span class=\"n\">fa</span>\n<span class=\"n\">evals2</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls_noisy</span><span class=\"o\">.</span><span class=\"n\">evals</span>\n<span class=\"n\">evecs2</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls_noisy</span><span class=\"o\">.</span><span class=\"n\">evecs</span>\n<span class=\"n\">cfa2</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">color_fa</span><span class=\"p\">(</span><span class=\"n\">fa2</span><span class=\"p\">,</span> <span class=\"n\">evecs2</span><span class=\"p\">)</span>\n\n<span class=\"n\">ren</span> <span class=\"o\">=</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">ren</span><span class=\"p\">()</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"n\">evals2</span><span class=\"p\">,</span> <span class=\"n\">evecs2</span><span class=\"p\">,</span> <span class=\"n\">cfa2</span><span class=\"p\">,</span> <span class=\"n\">sphere</span><span class=\"p\">))</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as tensor_ellipsoids_wls_noisy.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">n_frames</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tensor_ellipsoids_wls_noisy.png&#39;</span><span class=\"p\">,</span>\n            <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<p>In places where the tensor model is particularly sensitive to noise, the\nresulting tensor field will be distorted</p>\n<div class=\"figure align-center\" id=\"id9\">\n<img alt=\"../../_images/tensor_ellipsoids_wls_noisy.png\" src=\"../../_images/tensor_ellipsoids_wls_noisy.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Tensor Ellipsoids from noisy data</strong>.</span></p>\n</div>\n<p>To estimate the parameters from the noisy data using RESTORE, we need to\nestimate what would be a reasonable amount of noise to expect in the\nmeasurement. To do that, we use the <cite>dipy.denoise.noise_estimate</cite> module:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">dipy.denoise.noise_estimate</span> <span class=\"k\">as</span> <span class=\"nn\">ne</span>\n<span class=\"n\">sigma</span> <span class=\"o\">=</span> <span class=\"n\">ne</span><span class=\"o\">.</span><span class=\"n\">estimate_sigma</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>This estimate of the standard deviation will be used by the RESTORE algorithm\nto identify the outliers in each voxel and is given as an input when\ninitializing the TensorModel object:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dti_restore</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">TensorModel</span><span class=\"p\">(</span><span class=\"n\">gtab</span><span class=\"p\">,</span><span class=\"n\">fit_method</span><span class=\"o\">=</span><span class=\"s1\">&#39;RESTORE&#39;</span><span class=\"p\">,</span> <span class=\"n\">sigma</span><span class=\"o\">=</span><span class=\"n\">sigma</span><span class=\"p\">)</span>\n<span class=\"n\">fit_restore_noisy</span> <span class=\"o\">=</span> <span class=\"n\">dti_restore</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">noisy_data</span><span class=\"p\">)</span>\n<span class=\"n\">fa3</span> <span class=\"o\">=</span> <span class=\"n\">fit_restore_noisy</span><span class=\"o\">.</span><span class=\"n\">fa</span>\n<span class=\"n\">evals3</span> <span class=\"o\">=</span> <span class=\"n\">fit_restore_noisy</span><span class=\"o\">.</span><span class=\"n\">evals</span>\n<span class=\"n\">evecs3</span> <span class=\"o\">=</span> <span class=\"n\">fit_restore_noisy</span><span class=\"o\">.</span><span class=\"n\">evecs</span>\n<span class=\"n\">cfa3</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">color_fa</span><span class=\"p\">(</span><span class=\"n\">fa3</span><span class=\"p\">,</span> <span class=\"n\">evecs3</span><span class=\"p\">)</span>\n\n<span class=\"n\">ren</span> <span class=\"o\">=</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">ren</span><span class=\"p\">()</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"n\">evals3</span><span class=\"p\">,</span> <span class=\"n\">evecs3</span><span class=\"p\">,</span> <span class=\"n\">cfa3</span><span class=\"p\">,</span> <span class=\"n\">sphere</span><span class=\"p\">))</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as tensor_ellipsoids_restore_noisy.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">n_frames</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tensor_ellipsoids_restore_noisy.png&#39;</span><span class=\"p\">,</span>\n            <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id10\">\n<img alt=\"../../_images/tensor_ellipsoids_restore_noisy.png\" src=\"../../_images/tensor_ellipsoids_restore_noisy.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Tensor Ellipsoids from noisy data recovered with RESTORE</strong>.</span></p>\n</div>\n<p>The tensor field looks rather restored to its noiseless state in this\nimage, but to convince ourselves further that this did the right thing, we will\ncompare  the distribution of FA in this region relative to the baseline, using\nthe RESTORE estimate and the WLS estimate.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fig_hist</span><span class=\"p\">,</span> <span class=\"n\">ax</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplots</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">(</span><span class=\"n\">fa2</span><span class=\"p\">),</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;b&#39;</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;step&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;WLS&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">(</span><span class=\"n\">fa3</span><span class=\"p\">),</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;r&#39;</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;step&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;RESTORE&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">(</span><span class=\"n\">fa1</span><span class=\"p\">),</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;g&#39;</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;step&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;Original&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;Fractional Anisotropy&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;Count&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">()</span>\n<span class=\"n\">fig_hist</span><span class=\"o\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"s1\">&#39;dti_fa_distributions.png&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\">\n<img alt=\"../../_images/dti_fa_distributions.png\" src=\"../../_images/dti_fa_distributions.png\" />\n</div>\n<p>This demonstrates that RESTORE can recover a distribution of FA that more\nclosely resembles the baseline distribution of the noiseless signal, and\ndemonstrates the utility of the method to data with intermittent\nnoise. Importantly, this method assumes that the tensor is a good\nrepresentation of the diffusion signal in the data. If you have reason to\nbelieve this is not the case (for example, you have data with very high b\nvalues and you are particularly interested in locations in the brain in which\nfibers cross), you might want to use a different method to fit your data.</p>\n<div class=\"section\" id=\"references\">\n<h2>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<table class=\"docutils footnote\" frame=\"void\" id=\"id4\" rules=\"none\">\n<colgroup><col class=\"label\" /><col /></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\"><a class=\"fn-backref\" href=\"#id1\">[1]</a></td><td>Yendiki, A, Koldewynb, K, Kakunooria, S, Kanwisher, N, and Fischl,\nB. (2013). Spurious group differences due to head motion in a diffusion\nMRI study. Neuroimage.</td></tr>\n</tbody>\n</table>\n<table class=\"docutils footnote\" frame=\"void\" id=\"id5\" rules=\"none\">\n<colgroup><col class=\"label\" /><col /></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\">[2]</td><td><em>(<a class=\"fn-backref\" href=\"#id2\">1</a>, <a class=\"fn-backref\" href=\"#id3\">2</a>)</em> Chang, L-C, Jones, DK and Pierpaoli, C (2005). RESTORE: robust estimation\nof tensors by outlier rejection. MRM, 53: 1088-95.</td></tr>\n</tbody>\n</table>\n<table class=\"docutils footnote\" frame=\"void\" id=\"id6\" rules=\"none\">\n<colgroup><col class=\"label\" /><col /></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\">[3]</td><td>Chung, SW, Lu, Y, Henry, R-G, (2006). Comparison of bootstrap\napproaches for estimation of uncertainties of DTI parameters.\nNeuroImage 33, 531-541.</td></tr>\n</tbody>\n</table>\n<div class=\"admonition-example-source-code admonition\">\n<p class=\"first admonition-title\">Example source code</p>\n<p class=\"last\">You can download <a class=\"reference download internal\" href=\"../../_downloads/restore_dti.py\" download=\"\"><code class=\"xref download docutils literal\"><span class=\"pre\">the</span> <span class=\"pre\">full</span> <span class=\"pre\">source</span> <span class=\"pre\">code</span> <span class=\"pre\">of</span> <span class=\"pre\">this</span> <span class=\"pre\">example</span></code></a>.\nThis same script is also included in the dipy source distribution under the\n<code class=\"file docutils literal\"><span class=\"pre\">doc/examples/</span></code> directory.</p>\n</div>\n</div>\n</div>\n", "alabaster_version": "0.7.8", "display_toc": true, "title": "Using the RESTORE algorithm for robust tensor fitting", "sourcename": "examples_built/restore_dti.txt", "customsidebar": null, "metatags": "", "current_page_name": "examples_built/restore_dti", "next": null, "rellinks": [["genindex", "General Index", "I", "index"], ["np-modindex", "Python Module Index", "", "modules"]], "meta": {}, "parents": [], "sidebars": null, "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Using the RESTORE algorithm for robust tensor fitting</a><ul>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n", "prev": null, "page_source_suffix": ".rst"}
=======
{"body": "<div class=\"section\" id=\"using-the-restore-algorithm-for-robust-tensor-fitting\">\n<span id=\"example-restore-dti\"></span><h1>Using the RESTORE algorithm for robust tensor fitting<a class=\"headerlink\" href=\"#using-the-restore-algorithm-for-robust-tensor-fitting\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>The diffusion tensor model takes into account certain kinds of noise (thermal),\nbut not other kinds, such as &#8220;physiological&#8221; noise. For example, if a subject\nmoves during the acquisition of one of the diffusion-weighted samples, this\nmight have a substantial effect on the parameters of the tensor fit calculated\nin all voxels in the brain for that subject. One of the pernicious consequences\nof this is that it can lead to wrong interpretation of group differences. For\nexample, some groups of participants (e.g. young children, patient groups,\netc.) are particularly prone to motion and differences in tensor parameters and\nderived statistics (such as FA) due to motion would be confounded with actual\ndifferences in the physical properties of the white matter. An example of this\nwas shown in a paper by Yendiki et al. <a class=\"footnote-reference\" href=\"#id4\" id=\"id1\">[1]</a>.</p>\n<p>One of the strategies to deal with this problem is to apply an automatic method\nfor detecting outliers in the data, excluding these outliers and refitting the\nmodel without the presence of these outliers. This is often referred to as\n&#8220;robust model fitting&#8221;. One of the common algorithms for robust tensor fitting\nis called RESTORE, and was first proposed by Chang et al. <a class=\"footnote-reference\" href=\"#id5\" id=\"id2\">[2]</a>.</p>\n<p>In the following example, we will demonstrate how to use RESTORE on a simulated\ndataset, which we will corrupt by adding intermittent noise.</p>\n<p>We start by importing a few of the libraries we will use.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">nibabel</span> <span class=\"k\">as</span> <span class=\"nn\">nib</span>\n</pre></div>\n</div>\n<p>The module <code class=\"docutils literal\"><span class=\"pre\">dipy.reconst.dti</span></code> contains the implementation of tensor fitting,\nincluding an implementation of the RESTORE algorithm.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">dipy.reconst.dti</span> <span class=\"k\">as</span> <span class=\"nn\">dti</span>\n<span class=\"n\">reload</span><span class=\"p\">(</span><span class=\"n\">dti</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p><code class=\"docutils literal\"><span class=\"pre\">dipy.data</span></code> is used for small datasets that we use in tests and examples.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">dipy.data</span> <span class=\"k\">as</span> <span class=\"nn\">dpd</span>\n</pre></div>\n</div>\n<p><code class=\"docutils literal\"><span class=\"pre\">dipy.viz.fvtk</span></code> is used for 3D visualization and matplotlib for 2D\nvisualizations:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">dipy.viz.fvtk</span> <span class=\"k\">as</span> <span class=\"nn\">fvtk</span>\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"nn\">plt</span>\n</pre></div>\n</div>\n<p>If needed, the fetch_stanford_hardi function will download the raw dMRI dataset\nof a single subject. The size of this dataset is 87 MBytes. You only need to\nfetch once.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dpd</span><span class=\"o\">.</span><span class=\"n\">fetch_stanford_hardi</span><span class=\"p\">()</span>\n<span class=\"n\">img</span><span class=\"p\">,</span> <span class=\"n\">gtab</span> <span class=\"o\">=</span> <span class=\"n\">dpd</span><span class=\"o\">.</span><span class=\"n\">read_stanford_hardi</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>We initialize a DTI model class instance using the gradient table used in the\nmeasurement. By default, dti.Tensor model will use a weighted least-squares\nalgorithm (described in <a class=\"footnote-reference\" href=\"#id5\" id=\"id3\">[2]</a>) to fit the parameters of the model. We initialize\nthis model as a baseline for comparison of noise-corrupted models:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dti_wls</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">TensorModel</span><span class=\"p\">(</span><span class=\"n\">gtab</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>For the purpose of this example, we will focus on the data from a region of\ninterest (ROI) surrounding the Corpus Callosum. We define that ROI as the\nfollowing indices:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">roi_idx</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nb\">slice</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">,</span><span class=\"mi\">50</span><span class=\"p\">),</span> <span class=\"nb\">slice</span><span class=\"p\">(</span><span class=\"mi\">55</span><span class=\"p\">,</span><span class=\"mi\">85</span><span class=\"p\">),</span> <span class=\"nb\">slice</span><span class=\"p\">(</span><span class=\"mi\">38</span><span class=\"p\">,</span><span class=\"mi\">39</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<p>And use them to index into the data:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">img</span><span class=\"o\">.</span><span class=\"n\">get_data</span><span class=\"p\">()[</span><span class=\"n\">roi_idx</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>This dataset is not very noisy, so we will artificially corrupt it to simulate\nthe effects of &#8220;physiological&#8221; noise, such as subject motion. But first, let&#8217;s\nestablish a baseline, using the data as it is:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fit_wls</span> <span class=\"o\">=</span> <span class=\"n\">dti_wls</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n\n<span class=\"n\">fa1</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls</span><span class=\"o\">.</span><span class=\"n\">fa</span>\n<span class=\"n\">evals1</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls</span><span class=\"o\">.</span><span class=\"n\">evals</span>\n<span class=\"n\">evecs1</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls</span><span class=\"o\">.</span><span class=\"n\">evecs</span>\n<span class=\"n\">cfa1</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">color_fa</span><span class=\"p\">(</span><span class=\"n\">fa1</span><span class=\"p\">,</span> <span class=\"n\">evecs1</span><span class=\"p\">)</span>\n<span class=\"n\">sphere</span> <span class=\"o\">=</span> <span class=\"n\">dpd</span><span class=\"o\">.</span><span class=\"n\">get_sphere</span><span class=\"p\">(</span><span class=\"s1\">&#39;symmetric724&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>We visualize the ODFs in the ROI using fvtk:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">ren</span> <span class=\"o\">=</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">ren</span><span class=\"p\">()</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"n\">evals1</span><span class=\"p\">,</span> <span class=\"n\">evecs1</span><span class=\"p\">,</span> <span class=\"n\">cfa1</span><span class=\"p\">,</span> <span class=\"n\">sphere</span><span class=\"p\">))</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as tensor_ellipsoids_wls.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">n_frames</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tensor_ellipsoids_wls.png&#39;</span><span class=\"p\">,</span>\n            <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id8\">\n<img alt=\"examples_built/tensor_ellipsoids_wls.png\" src=\"examples_built/tensor_ellipsoids_wls.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Tensor Ellipsoids</strong>.</span></p>\n</div>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">clear</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Next, we corrupt the data with some noise. To simulate a subject that moves\nintermittently, we will replace a few of the images with a very low signal</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">noisy_data</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n<span class=\"n\">noisy_idx</span> <span class=\"o\">=</span> <span class=\"nb\">slice</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>  <span class=\"c1\"># The last 10 volumes are corrupted</span>\n<span class=\"n\">noisy_data</span><span class=\"p\">[</span><span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"n\">noisy_idx</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mf\">1.0</span>\n</pre></div>\n</div>\n<p>We use the same model to fit this noisy data</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fit_wls_noisy</span> <span class=\"o\">=</span> <span class=\"n\">dti_wls</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">noisy_data</span><span class=\"p\">)</span>\n<span class=\"n\">fa2</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls_noisy</span><span class=\"o\">.</span><span class=\"n\">fa</span>\n<span class=\"n\">evals2</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls_noisy</span><span class=\"o\">.</span><span class=\"n\">evals</span>\n<span class=\"n\">evecs2</span> <span class=\"o\">=</span> <span class=\"n\">fit_wls_noisy</span><span class=\"o\">.</span><span class=\"n\">evecs</span>\n<span class=\"n\">cfa2</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">color_fa</span><span class=\"p\">(</span><span class=\"n\">fa2</span><span class=\"p\">,</span> <span class=\"n\">evecs2</span><span class=\"p\">)</span>\n\n<span class=\"n\">ren</span> <span class=\"o\">=</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">ren</span><span class=\"p\">()</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"n\">evals2</span><span class=\"p\">,</span> <span class=\"n\">evecs2</span><span class=\"p\">,</span> <span class=\"n\">cfa2</span><span class=\"p\">,</span> <span class=\"n\">sphere</span><span class=\"p\">))</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as tensor_ellipsoids_wls_noisy.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">n_frames</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tensor_ellipsoids_wls_noisy.png&#39;</span><span class=\"p\">,</span>\n            <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<p>In places where the tensor model is particularly sensitive to noise, the\nresulting tensor field will be distorted</p>\n<div class=\"figure align-center\" id=\"id9\">\n<img alt=\"examples_built/tensor_ellipsoids_wls_noisy.png\" src=\"examples_built/tensor_ellipsoids_wls_noisy.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Tensor Ellipsoids from noisy data</strong>.</span></p>\n</div>\n<p>To estimate the parameters from the noisy data using RESTORE, we need to\nestimate what would be a reasonable amount of noise to expect in the\nmeasurement. To do that, we use the <cite>dipy.denoise.noise_estimate</cite> module:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">dipy.denoise.noise_estimate</span> <span class=\"k\">as</span> <span class=\"nn\">ne</span>\n<span class=\"n\">sigma</span> <span class=\"o\">=</span> <span class=\"n\">ne</span><span class=\"o\">.</span><span class=\"n\">estimate_sigma</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>This estimate of the standard deviation will be used by the RESTORE algorithm\nto identify the outliers in each voxel and is given as an input when\ninitializing the TensorModel object:</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">dti_restore</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">TensorModel</span><span class=\"p\">(</span><span class=\"n\">gtab</span><span class=\"p\">,</span><span class=\"n\">fit_method</span><span class=\"o\">=</span><span class=\"s1\">&#39;RESTORE&#39;</span><span class=\"p\">,</span> <span class=\"n\">sigma</span><span class=\"o\">=</span><span class=\"n\">sigma</span><span class=\"p\">)</span>\n<span class=\"n\">fit_restore_noisy</span> <span class=\"o\">=</span> <span class=\"n\">dti_restore</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">noisy_data</span><span class=\"p\">)</span>\n<span class=\"n\">fa3</span> <span class=\"o\">=</span> <span class=\"n\">fit_restore_noisy</span><span class=\"o\">.</span><span class=\"n\">fa</span>\n<span class=\"n\">evals3</span> <span class=\"o\">=</span> <span class=\"n\">fit_restore_noisy</span><span class=\"o\">.</span><span class=\"n\">evals</span>\n<span class=\"n\">evecs3</span> <span class=\"o\">=</span> <span class=\"n\">fit_restore_noisy</span><span class=\"o\">.</span><span class=\"n\">evecs</span>\n<span class=\"n\">cfa3</span> <span class=\"o\">=</span> <span class=\"n\">dti</span><span class=\"o\">.</span><span class=\"n\">color_fa</span><span class=\"p\">(</span><span class=\"n\">fa3</span><span class=\"p\">,</span> <span class=\"n\">evecs3</span><span class=\"p\">)</span>\n\n<span class=\"n\">ren</span> <span class=\"o\">=</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">ren</span><span class=\"p\">()</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">(</span><span class=\"n\">evals3</span><span class=\"p\">,</span> <span class=\"n\">evecs3</span><span class=\"p\">,</span> <span class=\"n\">cfa3</span><span class=\"p\">,</span> <span class=\"n\">sphere</span><span class=\"p\">))</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Saving illustration as tensor_ellipsoids_restore_noisy.png&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">fvtk</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">ren</span><span class=\"p\">,</span> <span class=\"n\">n_frames</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tensor_ellipsoids_restore_noisy.png&#39;</span><span class=\"p\">,</span>\n            <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id10\">\n<img alt=\"examples_built/tensor_ellipsoids_restore_noisy.png\" src=\"examples_built/tensor_ellipsoids_restore_noisy.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Tensor Ellipsoids from noisy data recovered with RESTORE</strong>.</span></p>\n</div>\n<p>The tensor field looks rather restored to its noiseless state in this\nimage, but to convince ourselves further that this did the right thing, we will\ncompare  the distribution of FA in this region relative to the baseline, using\nthe RESTORE estimate and the WLS estimate.</p>\n<div class=\"highlight-default\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fig_hist</span><span class=\"p\">,</span> <span class=\"n\">ax</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplots</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">(</span><span class=\"n\">fa2</span><span class=\"p\">),</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;b&#39;</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;step&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;WLS&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">(</span><span class=\"n\">fa3</span><span class=\"p\">),</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;r&#39;</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;step&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;RESTORE&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ravel</span><span class=\"p\">(</span><span class=\"n\">fa1</span><span class=\"p\">),</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;g&#39;</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;step&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;Original&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;Fractional Anisotropy&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ax</span><span class=\"o\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;Count&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">()</span>\n<span class=\"n\">fig_hist</span><span class=\"o\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"s1\">&#39;dti_fa_distributions.png&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\">\n<img alt=\"examples_built/dti_fa_distributions.png\" src=\"examples_built/dti_fa_distributions.png\" />\n</div>\n<p>This demonstrates that RESTORE can recover a distribution of FA that more\nclosely resembles the baseline distribution of the noiseless signal, and\ndemonstrates the utility of the method to data with intermittent\nnoise. Importantly, this method assumes that the tensor is a good\nrepresentation of the diffusion signal in the data. If you have reason to\nbelieve this is not the case (for example, you have data with very high b\nvalues and you are particularly interested in locations in the brain in which\nfibers cross), you might want to use a different method to fit your data.</p>\n<div class=\"section\" id=\"references\">\n<h2>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<table class=\"docutils footnote\" frame=\"void\" id=\"id4\" rules=\"none\">\n<colgroup><col class=\"label\" /><col /></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\"><a class=\"fn-backref\" href=\"#id1\">[1]</a></td><td>Yendiki, A, Koldewynb, K, Kakunooria, S, Kanwisher, N, and Fischl,\nB. (2013). Spurious group differences due to head motion in a diffusion\nMRI study. Neuroimage.</td></tr>\n</tbody>\n</table>\n<table class=\"docutils footnote\" frame=\"void\" id=\"id5\" rules=\"none\">\n<colgroup><col class=\"label\" /><col /></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\">[2]</td><td><em>(<a class=\"fn-backref\" href=\"#id2\">1</a>, <a class=\"fn-backref\" href=\"#id3\">2</a>)</em> Chang, L-C, Jones, DK and Pierpaoli, C (2005). RESTORE: robust estimation\nof tensors by outlier rejection. MRM, 53: 1088-95.</td></tr>\n</tbody>\n</table>\n<table class=\"docutils footnote\" frame=\"void\" id=\"id6\" rules=\"none\">\n<colgroup><col class=\"label\" /><col /></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\">[3]</td><td>Chung, SW, Lu, Y, Henry, R-G, (2006). Comparison of bootstrap\napproaches for estimation of uncertainties of DTI parameters.\nNeuroImage 33, 531-541.</td></tr>\n</tbody>\n</table>\n<div class=\"admonition-example-source-code admonition\">\n<p class=\"first admonition-title\">Example source code</p>\n<p class=\"last\">You can download <a class=\"reference download internal\" href=\"../../_downloads/restore_dti.py\" download=\"\"><code class=\"xref download docutils literal\"><span class=\"pre\">the</span> <span class=\"pre\">full</span> <span class=\"pre\">source</span> <span class=\"pre\">code</span> <span class=\"pre\">of</span> <span class=\"pre\">this</span> <span class=\"pre\">example</span></code></a>.\nThis same script is also included in the dipy source distribution under the\n<code class=\"file docutils literal\"><span class=\"pre\">doc/examples/</span></code> directory.</p>\n</div>\n</div>\n</div>\n", "alabaster_version": "0.7.7", "display_toc": true, "title": "Using the RESTORE algorithm for robust tensor fitting", "sourcename": "examples_built/restore_dti.txt", "customsidebar": null, "metatags": "", "current_page_name": "examples_built/restore_dti", "next": null, "rellinks": [["genindex", "General Index", "I", "index"], ["np-modindex", "Python Module Index", "", "modules"]], "meta": {}, "parents": [], "sidebars": null, "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Using the RESTORE algorithm for robust tensor fitting</a><ul>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n", "prev": null, "page_source_suffix": ".rst"}
>>>>>>> 1d6fdcf4511dbcfabbc73c3aa39a5e508df24b6c
